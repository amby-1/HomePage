<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members - Mechatronics Laboratory</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .member-card {
            display: flex;
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            align-items: center;
        }

        /* æ•™å“¡ä»¥å¤–ã®ã‚«ãƒ¼ãƒ‰ã¯ç¸¦æ–¹å‘ã®ã‚µã‚¤ã‚ºã‚’åŠåˆ†ã« */
        .member-card:not(.faculty) {
            padding: 10px;
        }

        .member-img {
            width: 100px;
            height: 100px;
            background-color: #eee;
            border-radius: 50%;
            margin-right: 20px;
            object-fit: cover;
        }

        /* æ•™å“¡ä»¥å¤–ã®ã‚«ãƒ¼ãƒ‰ã§ã¯ç”»åƒã‚’å°ã•ãã™ã‚‹ */
        .member-card:not(.faculty) .member-img {
            width: 60px;
            height: 60px;
            margin-right: 12px;
        }

        .member-info h3 {
            margin: 0 0 5px 0;
            color: var(--primary-color);
        }

        .member-link {
            color: inherit;
            text-decoration: none;
        }

        .member-link .external-icon {
            display: inline-block;
            width: 0.9em;
            height: 0.9em;
            margin-left: 0.3em;
            vertical-align: text-bottom;
            background: transparent;
        }

        .member-role {
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }

        /* ã‚°ãƒ«ãƒ¼ãƒ—é–“ã®ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆæ•™å“¡â€”åšå£«â€”ä¿®å£«â€”å­¦éƒ¨4å¹´ ã®é–“ã«æŒ¿å…¥ï¼‰ */
        .member-separator {
            height: 20px; /* ç©ºç™½ã®é«˜ã•ã‚’èª¿æ•´ */
            width: 100%;
            /* 2åˆ—ã‚°ãƒªãƒƒãƒ‰ã®å…¨åˆ—ã«ã¾ãŸãŒã‚‹ã‚ˆã†ã«ã™ã‚‹ */
            grid-column: 1 / -1;
        }

        /* members-grid ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªã‚°ãƒªãƒƒãƒ‰ã«ï¼ˆå¹…ã«å¿œã˜ã¦ 1 åˆ— / 2 åˆ— ã«åˆ‡æ›¿ï¼‰ */
        .members-grid {
            display: grid;
            /* Cap at 2 columns to avoid auto-creating a 3rd column on wider screens which makes cards narrower */
            grid-template-columns: repeat(2, minmax(320px, 1fr));
            gap: 20px; /* ã‚«ãƒ¼ãƒ‰é–“ã®éš™é–“ */
            align-items: start;
            width: 100%;
            box-sizing: border-box;
        }

        /* Force one column on narrower screens */
        @media (max-width: 760px) {
            .members-grid { grid-template-columns: 1fr; }
        }

        /* ã‚«ãƒ¼ãƒ‰ãŒè¦ªã‚³ãƒ³ãƒ†ãƒŠå¹…ã‚’è¶Šãˆãªã„ã‚ˆã†ã«ã™ã‚‹ */
        .member-card { min-width: 0; }
        .member-info { min-width: 0; }
        .member-info h3 { word-break: break-word; overflow-wrap: break-word; }

        /* ç”»åƒã®æŸ”è»Ÿãªã‚µã‚¤ã‚ºè¨­å®š */
    .member-img { width: 100px; height: 100px; max-width: 30%; flex: 0 0 auto; }
    .member-info { flex: 1 1 auto; }

        @media (max-width: 540px) {
            /* ç‹­ã„ç”»é¢ã§ã¯ã‚«ãƒ¼ãƒ‰å†…ã®ç”»åƒã‚’å°ã•ãã—ã¦åˆ—ã‚’1ã¤ã«è½ã¨ã™ */
            .member-img { width: 72px; height: 72px; max-width: 28%; margin-right: 12px; }
            .member-card:not(.faculty) .member-img { width: 50px; height: 50px; }
            .members-grid { grid-template-columns: 1fr; }
        }

        /* Wide screens: make name/info block take more space */
        @media (min-width: 1200px) {
            .member-img { width: 120px; height: 120px; max-width: 18%; }
            .member-info { padding-right: 24px; }
            .member-card:not(.faculty) .member-img { width: 70px; height: 70px; }
        }
    </style>
</head>

<body>

<div id="site-header"></div>
<script src="../js/header-en.js"></script>

<main class="container">
        <h2>Members</h2>
        <div style="margin: 10px 0 20px; font-size: 0.9rem;">
            <span style="display:inline-block; padding:2px 10px; background:#f3f8ff; border-left:6px solid #6699cc; margin-right:10px;">Takaki Group</span>
            <span style="display:inline-block; padding:2px 10px; background:#f2fbf4; border-left:6px solid #5fae7a;">Ambe Group</span>
        </div>
        <div id="members-container">
            <p>Loading members...</p>
        </div>

        <div style="margin-top: 40px; text-align: right;">
            <a href="alumni.html">Alumni &gt;</a>
        </div>
    </main>

    <div id="site-footer"></div>
    <script src="../js/footer-en.js"></script>

    <script src="../data/members.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
        const container = document.getElementById('members-container');
        container.innerHTML = '';

        if (typeof membersData === 'undefined') {
            container.textContent = 'Error loading members.';
            return;
        }

        const grid = document.createElement('div');
        grid.className = 'members-grid';
        container.appendChild(grid);

        const currentMembers = membersData.filter(m => m.year === 'current');

        function rankOf(m) {
            const r = (m.role_en || m.role || '').toUpperCase();
            if (r.includes('ASSISTANT PROFESSOR') || r.includes('ASSISTANT')) return 2;
            if (r.includes('ASSOCIATE PROFESSOR') || r.includes('ASSOCIATE')) return 1;
            if (r.includes('PROFESSOR')) return 0;

            if (r.startsWith('D')) return 10;
            if (r === 'M2') return 20;
            if (r === 'M1') return 30;
            if (r === 'B4') return 40;
            return 99;
        }

        // rank ã«åŸºã¥ã„ã¦ã‚«ãƒ†ã‚´ãƒªã‚­ãƒ¼ã‚’è¿”ã™ï¼ˆã“ã®ã‚«ãƒ†ã‚´ãƒªå¤‰åŒ–æ™‚ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¥ã‚Œã‚‹ï¼‰
        function groupKey(m) {
            const r = rankOf(m);
            if (r <= 2) return 'faculty';     // æ•™å“¡
            if (r === 10) return 'phd';       // åšå£«
            if (r === 20 || r === 30) return 'master'; // ä¿®å£«
            if (r === 40) return 'undergrad'; // å­¦éƒ¨4å¹´
            return 'other';
        }

        function groupClass(m) {
            // æ—¥æœ¬èª group ã§åˆ¤å®šã—ã¦OKï¼ˆãƒ‡ãƒ¼ã‚¿ã¯å…±é€šãªã®ã§ï¼‰
            if (m.group === 'é«˜æœ¨ã‚°ãƒ«ãƒ¼ãƒ—') return 'group-takaki';
            if (m.group === 'å®‰éƒ¨ã‚°ãƒ«ãƒ¼ãƒ—') return 'group-ambe';
            return '';
        }

        let prevGroup = null;
        currentMembers
            .slice()
            .sort((a, b) => {
            const ra = rankOf(a), rb = rankOf(b);
            if (ra !== rb) return ra - rb;
            return (a.name_en || a.name || '').localeCompare((b.name_en || b.name || ''), 'en');
            })
            .forEach(member => {
            // ã‚«ãƒ†ã‚´ãƒªãŒå¤‰ã‚ã‚‹ãƒã‚¤ãƒ³ãƒˆã§ç©ºç™½ï¼ˆseparatorï¼‰ã‚’æŒ¿å…¥ã™ã‚‹
            const g = groupKey(member);
            if (prevGroup !== null && g !== prevGroup) {
                const sep = document.createElement('div');
                sep.className = 'member-separator';
                grid.appendChild(sep);
            }
            prevGroup = g;

            const card = document.createElement('div');
            card.className = `member-card ${groupClass(member)}`;

            const img = document.createElement('img');
            img.className = 'member-img';
            if (member.image && !member.image.startsWith('http')) {
                img.src = '../' + member.image;
            } else {
                img.src = member.image || '../images/default_user.svg';
            }
            img.alt = member.name_en || member.name;
            img.onerror = function () { this.src = '../images/default_user.svg'; };

            const info = document.createElement('div');
            info.className = 'member-info';

            const name = document.createElement('h3');
            // åå‰ã«ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ãƒªãƒ³ã‚¯ãŒã‚ã‚Œã°ãƒªãƒ³ã‚¯åŒ–
            const displayName = member.name_en || member.name;
            if (member.homepage || member.url) {
                const a = document.createElement('a');
                a.className = 'member-link';
                a.href = member.homepage || member.url;
                a.target = '_blank';
                a.rel = 'noopener noreferrer';
                a.textContent = displayName;

                const ico = document.createElement('span');
                ico.className = 'external-icon';
                ico.textContent = 'ğŸ”—';
                a.appendChild(ico);

                name.appendChild(a);
            } else {
                name.textContent = displayName;
            }

            const role = document.createElement('div');
            role.className = 'member-role';
            role.textContent = member.role_en || member.role;

            const email = document.createElement('div');
            if (member.email) email.textContent = 'Email: ' + member.email;

            info.appendChild(name);
            info.appendChild(role);
            if (member.email) info.appendChild(email);

            card.appendChild(img);
            card.appendChild(info);
            grid.appendChild(card);
            });
        });
    </script>

</body>

</html>
